<html><head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF8">
  <style>
  p.C    { font-size: 80%; }
  li     { font-size: 80%; }
  h1     { font-size: 100%; font-weight: bold; padding-top: 1ex; padding-bottom: 1ex; }
  div.S1 { padding-left: 0px; font-weight: bold; page-break-inside: avoid; }
  div.S2 { padding-left: 20px; font-weight: bold; page-break-inside: avoid; border-left: 1px solid grey; }
  div.S3 { padding-left: 40px; font-weight: bold; page-break-inside: avoid; border-left: 3px double grey; }
  div.R1 { padding-left: 0px; page-break-inside: avoid; }
  div.R2 { padding-left: 20px; page-break-inside: avoid; border-left: 1px solid grey; }
  div.R3 { padding-left: 40px; page-break-inside: avoid; border-left: 3px double grey; }
  div.E  { padding-left: 0px; font-weight: bold; }
  div.R  { padding-left: 0px; }
  </style>
  </head>
  <body style="margin: 59.5px;">
  <!-- body -->
  <!--  -->
  <h1>
  1. Уровень изоляции Read Committed
  </h1>
  <p class="C">
  Создаем таблицу:
  </p>
  <div class="S1">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">CREATE TABLE</span> <span style="color:#c73a69">t</span><span style="color:#323232">(</span>n <span style="color:#a00050">integer</span><span style="color:#323232">);</span>
  </pre>
  </div>
  <div class="R1"><pre class="R1">CREATE TABLE
  </pre></div>
  <div class="S1">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">INSERT INTO</span> t <span style="color:#3b6ac8">VALUES</span> <span style="color:#323232">(</span><span style="color:#1094a0">42</span><span style="color:#323232">);</span>
  </pre>
  </div>
  <div class="R1"><pre class="R1">INSERT 0 1
  </pre></div>
  <p class="C">
  Запрос из первой транзакции:
  </p>
  <div class="S1">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">BEGIN</span><span style="color:#323232">;</span>
  </pre>
  </div>
  <div class="R1"><pre class="R1">BEGIN
  </pre></div>
  <div class="S1">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> <span style="color:#323232">*</span> <span style="color:#3b6ac8">FROM</span> t<span style="color:#323232">;</span>
  </pre>
  </div>
  <div class="R1"><pre class="R1"> n  
  ----
   42
  (1 row)
  
  </pre></div>
  <p class="C">
  Удаляем строку во второй транзакции и фиксируем изменения:
  </p>
  <div class="S2">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">DELETE FROM</span> t<span style="color:#323232">;</span>
  </pre>
  </div>
  <div class="R2"><pre class="R2">DELETE 1
  </pre></div>
  <p class="C">
  Повторим запрос:
  </p>
  <div class="S1">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> <span style="color:#323232">*</span> <span style="color:#3b6ac8">FROM</span> t<span style="color:#323232">;</span>
  </pre>
  </div>
  <div class="R1"><pre class="R1"> n 
  ---
  (0 rows)
  
  </pre></div>
  <p class="C">
  Первая транзакция видит произошедшие изменения.
  </p>
  <div class="S1">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">COMMIT</span><span style="color:#323232">;</span>
  </pre>
  </div>
  <div class="R1"><pre class="R1">COMMIT
  </pre></div>
  <h1>
  2. Уровень изоляции Repeatable Read
  </h1>
  <p class="C">
  Вернем строку:
  </p>
  <div class="S1">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">INSERT INTO</span> t <span style="color:#3b6ac8">VALUES</span> <span style="color:#323232">(</span><span style="color:#1094a0">42</span><span style="color:#323232">);</span>
  </pre>
  </div>
  <div class="R1"><pre class="R1">INSERT 0 1
  </pre></div>
  <p class="C">
  Запрос из первой транзакции:
  </p>
  <div class="S1">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">BEGIN ISOLATION LEVEL REPEATABLE READ</span><span style="color:#323232">;</span>
  </pre>
  </div>
  <div class="R1"><pre class="R1">BEGIN
  </pre></div>
  <div class="S1">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> <span style="color:#323232">*</span> <span style="color:#3b6ac8">FROM</span> t<span style="color:#323232">;</span>
  </pre>
  </div>
  <div class="R1"><pre class="R1"> n  
  ----
   42
  (1 row)
  
  </pre></div>
  <p class="C">
  Удаляем строку во второй транзакции и фиксируем изменения:
  </p>
  <div class="S2">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">DELETE FROM</span> t<span style="color:#323232">;</span>
  </pre>
  </div>
  <div class="R2"><pre class="R2">DELETE 1
  </pre></div>
  <p class="C">
  Повторим запрос:
  </p>
  <div class="S1">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> <span style="color:#323232">*</span> <span style="color:#3b6ac8">FROM</span> t<span style="color:#323232">;</span>
  </pre>
  </div>
  <div class="R1"><pre class="R1"> n  
  ----
   42
  (1 row)
  
  </pre></div>
  <p class="C">
  На этом уровне изоляции первая транзакция не видит изменений.
  </p>
  <div class="S1">
  <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">COMMIT</span><span style="color:#323232">;</span>
  </pre>
  </div>
  <div class="R1"><pre class="R1">COMMIT
  </pre></div>
  <!-- end -->
  
  
  </body></html>