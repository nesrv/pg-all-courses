<html><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF8">
    <style>
    p.C    { font-size: 80%; }
    li     { font-size: 80%; }
    h1     { font-size: 100%; font-weight: bold; padding-top: 1ex; padding-bottom: 1ex; }
    div.S1 { padding-left: 0px; font-weight: bold; page-break-inside: avoid; }
    div.S2 { padding-left: 20px; font-weight: bold; page-break-inside: avoid; border-left: 1px solid grey; }
    div.S3 { padding-left: 40px; font-weight: bold; page-break-inside: avoid; border-left: 3px double grey; }
    div.R1 { padding-left: 0px; page-break-inside: avoid; }
    div.R2 { padding-left: 20px; page-break-inside: avoid; border-left: 1px solid grey; }
    div.R3 { padding-left: 40px; page-break-inside: avoid; border-left: 3px double grey; }
    div.E  { padding-left: 0px; font-weight: bold; }
    div.R  { padding-left: 0px; }
    </style>
    </head>
    <body style="margin: 59.5px;">
    <!-- body -->
    <!-- 10 -->
    <h1>
    Параметры конфигурации
    </h1>
    <p class="C">
    Основной файл конфигурации postgresql.conf расположен в этом каталоге:
    </p>
    <div class="E">
    <pre style="color:#323232; background-color:#ffffff;  ">student$ <span style="color:#3b6ac8">ls</span> <span style="color:#323232">-</span>l <span style="color:#323232">/</span>etc<span style="color:#323232">/</span>postgresql<span style="color:#323232">/</span><span style="color:#1094a0">12</span><span style="color:#323232">/</span>main
    </pre>
    </div>
    <div class="R"><pre class="R">total 56
    drwxr-xr-x 2 postgres postgres  4096 июл 26 11:03 conf.d
    -rw-r--r-- 1 postgres postgres   315 июл 26 11:03 environment
    -rw-r--r-- 1 postgres postgres   143 июл 26 11:03 pg_ctl.conf
    -rw-r----- 1 postgres postgres  4933 июл 26 11:03 pg_hba.conf
    -rw-r----- 1 postgres postgres  1636 июл 26 11:03 pg_ident.conf
    -rw-r--r-- 1 postgres postgres 26922 июл 26 11:03 postgresql.conf
    -rw-r--r-- 1 postgres postgres   317 июл 26 11:03 start.conf
    </pre></div>
    <p class="C">
    Здесь же находятся и другие конфигурационные файлы.
    </p>
    <p class="C">
    Проверим значение параметра work_mem:
    </p>
    <div class="S1">
    <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SHOW</span> work_mem<span style="color:#323232">;</span>
    </pre>
    </div>
    <div class="R1"><pre class="R1"> work_mem 
    ----------
     4MB
    (1 row)
    
    </pre></div>
    <p class="C">
    Параметр work_mem задает объем памяти, который будет использоваться для внутренних операций сортировки и хеш-таблиц, прежде чем будут задействованы временные файлы на диске.
    </p>
    <p class="C">
    4MB — это значение по умолчанию, и оно слишком мало. Допустим, мы хотим увеличить его до 16MB для всего экземпляра. Для этого есть два пути.
    </p>
    <p class="C">
    Во-первых, можно внести изменение в postgresql.conf, раскомментировав и изменив строку, где определяется параметр:
    </p>
    <div class="E">
    <pre style="color:#323232; background-color:#ffffff;  ">student$ <span style="color:#3b6ac8">grep</span> <span style="color:#1094a0">'#work_mem'</span> <span style="color:#323232">/</span>etc<span style="color:#323232">/</span>postgresql<span style="color:#323232">/</span><span style="color:#1094a0">12</span><span style="color:#323232">/</span>main<span style="color:#323232">/</span>postgresql.conf
    </pre>
    </div>
    <div class="R"><pre class="R">#work_mem = 4MB				# min 64kB
    </pre></div>
    <p class="C">
    Во-вторых, можно изменить параметр с помощью команды SQL — что мы и сделаем:
    </p>
    <div class="S1">
    <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">ALTER SYSTEM SET</span> work_mem <span style="color:#3b6ac8">TO</span> <span style="color:#1094a0">'16MB'</span><span style="color:#323232">;</span>
    </pre>
    </div>
    <div class="R1"><pre class="R1">ALTER SYSTEM
    </pre></div>
    <p class="C">
    Такое изменение попадает не в postgresql.conf, а в другой файл (он находится в каталоге PGDATA):
    </p>
    <div class="E">
    <pre style="color:#323232; background-color:#ffffff;  ">student$ <span style="color:#a00050">sudo</span> <span style="color:#3b6ac8">cat</span> <span style="color:#323232">/</span>var<span style="color:#323232">/</span>lib<span style="color:#323232">/</span>postgresql<span style="color:#323232">/</span><span style="color:#1094a0">12</span><span style="color:#323232">/</span>main<span style="color:#323232">/</span>postgresql.auto.conf
    </pre>
    </div>
    <div class="R"><pre class="R"># Do not edit this file manually!
    # It will be overwritten by the ALTER SYSTEM command.
    work_mem = '16MB'
    </pre></div>
    <p class="C">
    Чтобы изменение вступило в силу, нужно перечитать конфигурационные файлы. Можно либо воспользоваться pg_ctlcluster, либо использовать функцию SQL:
    </p>
    <div class="S1">
    <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> <span style="color:#c73a69">pg_reload_conf</span><span style="color:#323232">();</span>
    </pre>
    </div>
    <div class="R1"><pre class="R1"> pg_reload_conf 
    ----------------
     t
    (1 row)
    
    </pre></div>
    <p class="C">
    Проверим, что новое значение параметра применилось. Кроме команды SHOW можно сделать это таким образом:
    </p>
    <div class="S1">
    <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> <span style="color:#c73a69">current_setting</span><span style="color:#323232">(</span><span style="color:#1094a0">'work_mem'</span><span style="color:#323232">);</span>
    </pre>
    </div>
    <div class="R1"><pre class="R1"> current_setting 
    -----------------
     16MB
    (1 row)
    
    </pre></div>
    <p class="C">
    Чтобы восстановить значение параметра по умолчанию, достаточно вместо SET использовать команду RESET (и, конечно, перечитать конфигурационные файлы):
    </p>
    <div class="S1">
    <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">ALTER SYSTEM RESET</span> work_mem<span style="color:#323232">;</span>
    </pre>
    </div>
    <div class="R1"><pre class="R1">ALTER SYSTEM
    </pre></div>
    <div class="S1">
    <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> <span style="color:#c73a69">pg_reload_conf</span><span style="color:#323232">();</span>
    </pre>
    </div>
    <div class="R1"><pre class="R1"> pg_reload_conf 
    ----------------
     t
    (1 row)
    
    </pre></div>
    <hr size="0" style="border-top: 1px dashed grey; border-bottom: 0;">
    <p class="C">
    Большинству параметров можно установить новое значение для текущего сеанса во время выполнения. Например, если мы собираемся выполнить запрос, сортирующий большой объем данных, то для сеанса можно увеличить значение work_mem:
    </p>
    <div class="S1">
    <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SET</span> work_mem <span style="color:#323232">=</span> <span style="color:#1094a0">'64MB'</span><span style="color:#323232">;</span>
    </pre>
    </div>
    <div class="R1"><pre class="R1">SET
    </pre></div>
    <p class="C">
    Проверим, что значение применилось, еще одним способом — выполним запрос к представлению:
    </p>
    <div class="S1">
    <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> name<span style="color:#323232">,</span> setting<span style="color:#323232">,</span> unit <span style="color:#3b6ac8">FROM</span> pg_settings <span style="color:#3b6ac8">WHERE</span> name <span style="color:#323232">=</span> <span style="color:#1094a0">'work_mem'</span><span style="color:#323232">;</span>
    </pre>
    </div>
    <div class="R1"><pre class="R1">   name   | setting | unit 
    ----------+---------+------
     work_mem | 65536   | kB
    (1 row)
    
    </pre></div>
    <p class="C">
    Новое значение действует только в текущем сеансе или в текущей транзакции (при указании SET LOCAL).
    
    <!-- end -->
    
    
    </p></body></html>


    <html><head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF8">
        <style>
        p.C    { font-size: 80%; }
        li     { font-size: 80%; }
        h1     { font-size: 100%; font-weight: bold; padding-top: 1ex; padding-bottom: 1ex; }
        div.S1 { padding-left: 0px; font-weight: bold; page-break-inside: avoid; }
        div.S2 { padding-left: 20px; font-weight: bold; page-break-inside: avoid; border-left: 1px solid grey; }
        div.S3 { padding-left: 40px; font-weight: bold; page-break-inside: avoid; border-left: 3px double grey; }
        div.R1 { padding-left: 0px; page-break-inside: avoid; }
        div.R2 { padding-left: 20px; page-break-inside: avoid; border-left: 1px solid grey; }
        div.R3 { padding-left: 40px; page-break-inside: avoid; border-left: 3px double grey; }
        div.E  { padding-left: 0px; font-weight: bold; }
        div.R  { padding-left: 0px; }
        </style>
        </head>
        <body style="margin: 59.5px;">
        <!-- body -->
        <!-- 12 -->
        <h1>
        Подключение
        </h1>
        <p class="C">
        При запуске psql нужно указать параметры подключения. К обязательным параметрам относятся:
        </p>
        <ul class="U">
        <li>
        имя базы данных, по умолчанию совпадает с именем пользователя;
        </li>
        <li>
        имя пользователя (роль), по умолчанию совпадает с именем пользователя ОС;
        </li>
        <li>
        узел, по умолчанию — локальное соединение;
        </li>
        <li>
        порт, по умолчанию — обычно 5432.
        </li>
        </ul>
        <p class="C">
        Параметры указываются так:
        </p>
        <div class="E">
        <pre style="color:#323232; background-color:#ffffff;  ">student$ <span style="color:#00a150">psql</span> <span style="color:#323232">-</span>d база <span style="color:#323232">-</span>U роль <span style="color:#323232">-</span>h узел <span style="color:#323232">-</span>p порт
        </pre>
        </div>
        <p class="C">
        Настройки, сделанные в виртуальной машине, позволяют подключаться к PostgreSQL без указания параметров:
        </p>
        <div class="E">
        <pre style="color:#323232; background-color:#ffffff;  ">student$ <span style="color:#00a150">psql</span> 
        </pre>
        </div>
        <p class="C">
        Проверим текущее подключение:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\conninfo</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">You are connected to database "student" as user "student" via socket in "/var/run/postgresql" at port "5432".
        </pre></div>
        <p class="C">
        Команда \connect выполняет новое подключение, не покидая psql. Ее можно сократить до \c. Мы будем указывать необязательную часть имени команды в квадратных скобках: \c[onnect].
        </p>
        <hr size="0" style="border-top: 1px dashed grey; border-bottom: 0;">
        <h1>
        Справочная информация
        </h1>
        <p class="C">
        Справку по psql можно получить не только в документации, но и прямо в системе. Команда
        </p>
        <div class="E">
        <pre style="color:#323232; background-color:#ffffff;  ">student$ <span style="color:#00a150">psql</span> <span style="color:#323232">--</span>help
        </pre>
        </div>
        <p class="C">
        выдает справку по запуску. А если в системе установлена документация, то справочное руководство можно получить командой
        </p>
        <div class="E">
        <pre style="color:#323232; background-color:#ffffff;  ">student$ <span style="color:#3b6ac8">man</span> <span style="color:#00a150">psql</span>
        </pre>
        </div>
        <hr size="0" style="border-top: 1px dashed grey; border-bottom: 0;">
        <p class="C">
        Утилита psql умеет выполнять команды SQL и свои собственные команды, которые начинаются с обратной косой черты, как \conninfo.
        </p>
        <p class="C">
        Внутри psql есть возможность получить список и краткое описание команд:
        </p>
        <ul class="U">
        <li>
        \h[elp] выдает список команд SQL, которые поддерживает сервер, а также синтаксис конкретной команды SQL.
        </li>
        <li>
        \? выдает список команд psql.
        </li>
        </ul>
        <hr size="0" style="border-top: 1px dashed grey; border-bottom: 0;">
        <h1>
        Форматирование вывода
        </h1>
        <p class="C">
        Клиент psql умеет выводить результат запросов в разных форматах:
        </p>
        <ul class="U">
        <li>
        формат с выравниванием значений;
        </li>
        <li>
        формат без выравнивания;
        </li>
        <li>
        расширенный формат.
        </li>
        </ul>
        <p class="C">
        Формат с выравниванием используется по умолчанию:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> name<span style="color:#323232">,</span> setting<span style="color:#323232">,</span> unit <span style="color:#3b6ac8">FROM</span> pg_settings <span style="color:#3b6ac8">LIMIT</span> <span style="color:#1094a0">7</span><span style="color:#323232">;</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">          name           |  setting   | unit 
        -------------------------+------------+------
         allow_system_table_mods | off        | 
         application_name        | psql       | 
         archive_cleanup_command |            | 
         archive_command         | (disabled) | 
         archive_mode            | off        | 
         archive_timeout         | 0          | s
         array_nulls             | on         | 
        (7 rows)
        
        </pre></div>
        <p class="C">
        Ширина столбцов выровнена по значениям. Также выводится строка заголовков и итоговая строка.
        </p>
        <p class="C">
        Команды psql для переключения режима выравнивания:
        </p>
        <ul class="U">
        <li>
        \a — переключатель режима: с выравниванием/без выравнивания.
        </li>
        <li>
        \t — переключатель отображения строки заголовка и итоговой строки.
        </li>
        </ul>
        <p class="C">
        Отключим выравнивание, заголовок и итоговую строку:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\a \t</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">Output format is unaligned.
        Tuples only is on.
        </pre></div>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> name<span style="color:#323232">,</span> setting<span style="color:#323232">,</span> unit <span style="color:#3b6ac8">FROM</span> pg_settings <span style="color:#3b6ac8">LIMIT</span> <span style="color:#1094a0">7</span><span style="color:#323232">;</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">allow_system_table_mods|off|
        application_name|psql|
        archive_cleanup_command||
        archive_command|(disabled)|
        archive_mode|off|
        archive_timeout|0|s
        array_nulls|on|
        </pre></div>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\a \t</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">Output format is aligned.
        Tuples only is off.
        </pre></div>
        <p class="C">
        Такой формат неудобен для просмотра, но может оказаться полезным для автоматической обработки.
        </p>
        <hr size="0" style="border-top: 1px dashed grey; border-bottom: 0;">
        <p class="C">
        Расширенный формат удобен, когда нужно вывести много столбцов для одной или нескольких записей. Для этого вместо точки с запятой указываем в конце команды \gx:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> name<span style="color:#323232">,</span> setting<span style="color:#323232">,</span> unit<span style="color:#323232">,</span> category<span style="color:#323232">,</span> context<span style="color:#323232">,</span> vartype<span style="color:#323232">,</span>
            min_val<span style="color:#323232">,</span> max_val<span style="color:#323232">,</span> boot_val<span style="color:#323232">,</span> reset_val
        <span style="color:#3b6ac8">FROM</span> pg_settings
        <span style="color:#3b6ac8">WHERE</span> name <span style="color:#323232">=</span> <span style="color:#1094a0">'work_mem'</span> <span style="color:#00a150">\gx</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">-[ RECORD 1 ]----------------------
        name      | work_mem
        setting   | 4096
        unit      | kB
        category  | Resource Usage / Memory
        context   | user
        vartype   | integer
        min_val   | 64
        max_val   | 2147483647
        boot_val  | 4096
        reset_val | 4096
        
        </pre></div>
        <p class="C">
        Если расширенный формат нужен не для одной команды, а постоянно, можно включить его переключателем \x.
        </p>
        <p class="C">
        Все возможности форматирования результатов запросов доступны через команду \pset.
        </p>
        <hr size="0" style="border-top: 1px dashed grey; border-bottom: 0;">
        <h1>
        Взаимодействие с ОС и выполнение скриптов
        </h1>
        <p class="C">
        Из psql можно выполнять команды shell:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\!</span> pwd
        </pre>
        </div>
        <div class="R1"><pre class="R1">/home/student
        </pre></div>
        <p class="C">
        С помощью запроса SQL можно сформировать несколько других запросов SQL и записать их в файл, используя команду \o[ut]:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\a \t</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">Output format is unaligned.
        Tuples only is on.
        </pre></div>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\pset</span> fieldsep <span style="color:#1094a0">''</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">Field separator is "".
        </pre></div>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\o</span> dev1_psql.log
        </pre>
        </div>
        <div class="R1"><pre class="R1"></pre></div>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> <span style="color:#c73a69">format</span><span style="color:#323232">(</span><span style="color:#1094a0">'SELECT %L AS tbl, count(*) FROM %I;'</span><span style="color:#323232">,</span> tablename<span style="color:#323232">,</span> tablename<span style="color:#323232">)</span>
        <span style="color:#3b6ac8">FROM</span> pg_tables <span style="color:#3b6ac8">LIMIT</span> <span style="color:#1094a0">3</span><span style="color:#323232">;</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1"></pre></div>
        <p class="C">
        На экран ничего не попало. Посмотрим в файле:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\!</span> cat dev1_psql.log
        </pre>
        </div>
        <div class="R1"><pre class="R1">SELECT 'pg_statistic' AS tbl, count(*) FROM pg_statistic;
        SELECT 'pg_type' AS tbl, count(*) FROM pg_type;
        SELECT 'pg_foreign_server' AS tbl, count(*) FROM pg_foreign_server;
        </pre></div>
        <p class="C">
        Вернем вывод на экран и восстановим форматирование по умолчанию.
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\o \t \a</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">Tuples only is off.
        Output format is aligned.
        </pre></div>
        <p class="C">
        Выполним теперь эти команды из файла с помощью \i[nclude]:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\i</span> dev1_psql.log
        </pre>
        </div>
        <div class="R1"><pre class="R1">     tbl      | count 
        --------------+-------
         pg_statistic |   422
        (1 row)
        
           tbl   | count 
        ---------+-------
         pg_type |   406
        (1 row)
        
                tbl        | count 
        -------------------+-------
         pg_foreign_server |     0
        (1 row)
        
        </pre></div>
        <p class="C">
        Впрочем, то же самое можно получить за один шаг, используя команду \gexec:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> <span style="color:#c73a69">format</span><span style="color:#323232">(</span><span style="color:#1094a0">'SELECT %L AS tbl, count(*) FROM %I;'</span><span style="color:#323232">,</span> tablename<span style="color:#323232">,</span> tablename<span style="color:#323232">)</span>
        <span style="color:#3b6ac8">FROM</span> pg_tables <span style="color:#3b6ac8">LIMIT</span> <span style="color:#1094a0">3</span> <span style="color:#00a150">\gexec</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">     tbl      | count 
        --------------+-------
         pg_statistic |   422
        (1 row)
        
           tbl   | count 
        ---------+-------
         pg_type |   406
        (1 row)
        
                tbl        | count 
        -------------------+-------
         pg_foreign_server |     0
        (1 row)
        
        </pre></div>
        <p class="C">
        Другие способы выполнить команды из файла:
        </p>
        <ul class="U">
        <li>
        psql &lt; имя_файла
        </li>
        <li>
        psql -f имя_файла
        </li>
        <li>
        psql -c 'команда' (работает только для одной команды)
        </li>
        </ul>
        <hr size="0" style="border-top: 1px dashed grey; border-bottom: 0;">
        <h1>
        Переменные psql
        </h1>
        <p class="C">
        По аналогии с shell, psql имеет собственные переменные.
        </p>
        <p class="C">
        Установим переменную:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\set</span> TEST Hi<span style="color:#323232">!</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1"></pre></div>
        <p class="C">
        Чтобы получить значение, надо предварить имя переменной двоеточием:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\echo :TEST</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">Hi!
        </pre></div>
        <p class="C">
        Значение переменной можно сбросить:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\unset</span> TEST
        </pre>
        </div>
        <div class="R1"><pre class="R1"></pre></div>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\echo :TEST</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">:TEST
        </pre></div>
        <p class="C">
        Переменные можно использовать, например, для хранения текста часто используемых запросов. Вот запрос на получение пяти самых больших по размеру таблиц:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\set</span> top5 <span style="color:#1094a0">'SELECT tablename, pg_total_relation_size(schemaname||'</span><span style="color:#1094a0">'.'</span><span style="color:#1094a0">'||tablename) AS bytes FROM pg_tables ORDER BY bytes DESC LIMIT 5;'</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1"></pre></div>
        <p class="C">
        Для выполнения запроса достаточно набрать:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">:top5</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">   tablename    |  bytes  
        ----------------+---------
         pg_depend      | 1130496
         pg_proc        | 1015808
         pg_attribute   |  688128
         pg_rewrite     |  679936
         pg_description |  573440
        (5 rows)
        
        </pre></div>
        <p class="C">
        Присвоение значения переменной top5 лучше записать в стартовый файл .psqlrc в домашнем каталоге пользователя. Команды из .psqlrc будут автоматически выполняться каждый раз при старте psql.
        </p>
        <hr size="0" style="border-top: 1px dashed grey; border-bottom: 0;">
        <p class="C">
        Результат запроса можно записать в переменную с помощью \gset:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#3b6ac8">SELECT</span> <span style="color:#c73a69">current_setting</span><span style="color:#323232">(</span><span style="color:#1094a0">'work_mem'</span><span style="color:#323232">)</span> <span style="color:#3b6ac8">AS</span> current_work_mem <span style="color:#00a150">\gset</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1"></pre></div>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#323232">=&gt;</span> <span style="color:#00a150">\echo</span> Значение work_mem<span style="color:#323232">:</span> <span style="color:#00a150">:current_work_mem</span>
        </pre>
        </div>
        <div class="R1"><pre class="R1">Значение work_mem: 4MB
        </pre></div>
        <p class="C">
        Без параметров \set выдает значения всех переменных, включая встроенные. Справку по встроенным переменным можно получить так:
        </p>
        <div class="S1">
        <pre style="color:#323232; background-color:#ffffff;"><span style="color:#00a150">\?</span> variables
        </pre>
        </div>
        <!-- end -->
        
        
        </body></html>

        